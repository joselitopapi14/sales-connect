# Estructura Actualizada - Users Table

## üìã Cambios Realizados

Se ha actualizado toda la aplicaci√≥n para usar la nueva estructura de la tabla `Users` de Supabase.

## üóÑÔ∏è Nueva Estructura de la Tabla

```sql
CREATE TABLE public."Users" (
  id UUID NOT NULL DEFAULT auth.uid(),
  name TEXT NOT NULL,
  phone TEXT NOT NULL,
  email TEXT NOT NULL,
  cedula TEXT NOT NULL,
  created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT NOW(),
  CONSTRAINT Users_pkey PRIMARY KEY (id),
  CONSTRAINT Users_cedula_key UNIQUE (cedula),
  CONSTRAINT Users_email_key UNIQUE (email),
  CONSTRAINT Users_phone_key UNIQUE (phone)
) TABLESPACE pg_default;
```

## üìä Campos de Usuario

| Campo | Tipo | Requerido | √önico | Descripci√≥n |
|-------|------|-----------|-------|-------------|
| **id** | UUID | ‚úÖ | ‚úÖ | ID √∫nico del usuario |
| **name** | TEXT | ‚úÖ | ‚ùå | Nombre completo |
| **phone** | TEXT | ‚úÖ | ‚úÖ | Tel√©fono (√∫nico) |
| **email** | TEXT | ‚úÖ | ‚úÖ | Email (√∫nico) |
| **cedula** | TEXT | ‚úÖ | ‚úÖ | C√©dula/ID (√∫nico) |
| **created_at** | TIMESTAMP | ‚úÖ | ‚ùå | Fecha de creaci√≥n |

## üîÑ Archivos Modificados

### 1. **Type Definition** (`data/users/columns.tsx`)

```typescript
export type User = {
  id: string;
  name: string;
  phone: string;
  email: string;
  cedula: string;
  created_at?: string;
};
```

**Cambios:**
- ‚ùå Eliminado: `company` (opcional)
- ‚ùå Eliminado: `role` (admin|user|manager|guest)
- ‚úÖ Agregado: `cedula` (requerido, √∫nico)
- ‚úÖ Modificado: `phone` ahora es requerido (no opcional)

### 2. **Columnas de la Tabla** (`data/users/columns.tsx`)

Columnas visibles en la tabla:
- ‚òëÔ∏è Checkbox de selecci√≥n
- üë§ Name (ordenable)
- üìß Email (ordenable)
- üì± Phone
- üÜî C√©dula
- ‚öôÔ∏è Actions (editar, ver, eliminar)

### 3. **Formulario de Creaci√≥n** (`components/FieldDemo.tsx`)

Campos del formulario:
1. **Full Name** (requerido)
2. **Email Address** (requerido, tipo email)
3. **Phone Number** (requerido, tipo tel)
4. **C√©dula** (requerido, n√∫mero de identificaci√≥n)

**Eliminados:**
- ‚ùå Company (campo opcional)
- ‚ùå Role (selector)

### 4. **Formulario de Edici√≥n** (`components/EditUserDialog.tsx`)

Campos editables:
1. Name
2. Email
3. Phone
4. C√©dula

**Eliminados:**
- ‚ùå Company
- ‚ùå Role (selector)

### 5. **Context API** (`contexts/UsersContext.tsx`)

- Tabla: `"Users"` (con may√∫scula)
- Tipo correcto para `addUser`: `Omit<User, "id" | "created_at">`
- Tipo correcto para `updateUser`: `Partial<Omit<User, "id" | "created_at">>`

### 6. **Services** (`services/users.ts`)

Todas las operaciones ahora usan la tabla `"Users"`:
- `getAll()`
- `getById(id)`
- `create(user)`
- `update(id, updates)`
- `delete(id)`
- `deleteMany(ids)`

## ‚úÖ Validaciones √önicas

Los siguientes campos tienen restricci√≥n UNIQUE en la base de datos:

1. **email** - No se pueden registrar dos usuarios con el mismo email
2. **phone** - No se pueden registrar dos usuarios con el mismo tel√©fono
3. **cedula** - No se pueden registrar dos usuarios con la misma c√©dula

## üîç √çndices Creados

Para optimizar las b√∫squedas:

```sql
CREATE INDEX idx_users_email ON public."Users"(email);
CREATE INDEX idx_users_cedula ON public."Users"(cedula);
CREATE INDEX idx_users_phone ON public."Users"(phone);
```

## üéØ Funcionalidades

### ‚úÖ CREATE (Crear)
- Formulario con 4 campos requeridos
- Validaci√≥n de formato de email y tel√©fono
- Reset autom√°tico despu√©s de crear
- Validaci√≥n de campos √∫nicos (email, phone, cedula)

### ‚úÖ READ (Leer)
- Visualizaci√≥n de todos los usuarios
- Filtro por email en tiempo real
- Ordenamiento por name y email
- Paginaci√≥n autom√°tica

### ‚úÖ UPDATE (Actualizar)
- Edici√≥n de todos los campos excepto id y created_at
- Di√°logo modal intuitivo
- Validaci√≥n de campos √∫nicos

### ‚úÖ DELETE (Eliminar)
- Selecci√≥n m√∫ltiple con checkboxes
- Eliminaci√≥n en lote
- Confirmaci√≥n visual

## üìù Ejemplo de Uso

### Crear Usuario

```typescript
const newUser = {
  name: "Juan P√©rez",
  email: "juan@example.com",
  phone: "+593-99-123-4567",
  cedula: "1234567890"
};

await addUser(newUser);
```

### Actualizar Usuario

```typescript
await updateUser(userId, {
  phone: "+593-99-999-9999",
  email: "nuevo@example.com"
});
```

### Eliminar Usuarios

```typescript
await deleteUsers([userId1, userId2, userId3]);
```

## üöÄ Pr√≥ximos Pasos Recomendados

1. **Validaciones Adicionales:**
   - Formato de c√©dula ecuatoriana (10 d√≠gitos)
   - Formato de tel√©fono celular
   - Validaci√≥n de email m√°s estricta

2. **Funcionalidades Extra:**
   - B√∫squeda por c√©dula
   - B√∫squeda por tel√©fono
   - Exportar usuarios a CSV/Excel
   - Importar usuarios desde archivo

3. **Seguridad:**
   - Implementar autenticaci√≥n
   - Ajustar pol√≠ticas RLS
   - Validar permisos por roles

4. **UX Mejorada:**
   - M√°scaras de entrada para tel√©fono
   - Validaci√≥n en tiempo real de unicidad
   - Mensajes de error m√°s descriptivos
   - Confirmaci√≥n antes de eliminar

## ‚ö†Ô∏è Notas Importantes

- El nombre de la tabla es `"Users"` con may√∫scula inicial y entre comillas
- Todos los campos (excepto `created_at`) son requeridos en el formulario
- La tabla usa `auth.uid()` para el ID, preparada para integraci√≥n con autenticaci√≥n
- Las restricciones UNIQUE se validan a nivel de base de datos
